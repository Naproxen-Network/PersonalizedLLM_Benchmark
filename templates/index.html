<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ¯</span>
                <div class="logo-text">
                    <h1>{{ t.title }}</h1>
                    <p>{{ t.subtitle }}</p>
                </div>
            </div>
            <nav class="nav">
                <a href="#upload" class="nav-link active">{{ t.upload }}</a>
                <a href="#evaluate" class="nav-link">{{ t.evaluate }}</a>
                <a href="#results" class="nav-link">{{ t.results }}</a>
                <a href="#docs" class="nav-link">{{ t.docs }}</a>
            </nav>
            <div class="language-selector">
                {% for code, name in languages.items() %}
                <button class="lang-btn {% if lang == code %}active{% endif %}" 
                        onclick="setLanguage('{{ code }}')">{{ name }}</button>
                {% endfor %}
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Upload Section -->
        <section id="upload" class="section">
            <div class="section-header">
                <h2>ğŸ“¤ {{ t.upload_title }}</h2>
                <p>{{ t.upload_desc }}</p>
            </div>
            
            <div class="upload-area" id="dropZone">
                <div class="upload-icon">ğŸ“</div>
                <p class="upload-text">{{ t.select_file }}</p>
                <p class="upload-hint">{{ t.drag_drop }}</p>
                <p class="upload-format">{{ t.file_format }}</p>
                <input type="file" id="fileInput" accept=".jsonl" hidden>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    {{ t.upload_btn }}
                </button>
                <a href="/download_template" class="btn btn-secondary">
                    {{ t.download_template }}
                </a>
            </div>
            
            <div id="uploadStatus" class="status-box hidden">
                <div class="status-icon">âœ…</div>
                <div class="status-text"></div>
            </div>
        </section>

        <!-- Evaluation Section -->
        <section id="evaluate" class="section">
            <div class="section-header">
                <h2>ğŸ”¬ {{ t.eval_title }}</h2>
                <p>{{ t.eval_desc }}</p>
            </div>
            
            <div class="eval-config">
                <div class="method-selector">
                    <h3>{{ t.select_methods }}</h3>
                    <div class="method-list" id="methodList">
                        <!-- Methods will be populated dynamically -->
                    </div>
                </div>
                
                <button class="btn btn-primary btn-large" id="startEvalBtn" disabled onclick="startEvaluation()">
                    {{ t.start_eval }}
                </button>
                
                <div id="evalProgress" class="progress-container hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">{{ t.evaluating }}</p>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results" class="section hidden">
            <div class="section-header">
                <h2>ğŸ“Š {{ t.results_title }}</h2>
                <button class="btn btn-secondary" onclick="exportResults()">{{ t.export_results }}</button>
            </div>
            
            <!-- Metrics Cards -->
            <div class="metrics-grid" id="metricsGrid">
                <!-- Will be populated dynamically -->
            </div>
            
            <!-- Charts -->
            <div class="charts-container">
                <div class="chart-box">
                    <h3>{{ t.al_curve_title }}</h3>
                    <canvas id="alCurveChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>{{ t.radar_title }}</h3>
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
            
            <!-- Comparison Table -->
            <div class="table-container">
                <h3>{{ t.details_title }}</h3>
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>AVG</th>
                            <th>Slope (b)</th>
                            <th>RÂ²</th>
                            <th>Improvement</th>
                            <th>Binary Rate</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Documentation Section -->
        <section id="docs" class="section">
            <div class="section-header">
                <h2>ğŸ“š {{ t.docs }}</h2>
            </div>
            
            <div class="docs-container">
                <div class="doc-card">
                    <h3>{{ t.doc_format_title }}</h3>
                    <p>{{ t.doc_format_desc }}</p>
                    <pre class="code-block">{
  "session_id": "user_001_session_001",
  "user_profile": "He is a 22-year-old college student...",
  "user_personality": "He is curious and open-minded...",
  "rounds": [
    {
      "round": 1,
      "user_message": "Hey, nice to meet you!",
      "responses": {
        "Base": "Hello! How can I help you?",
        "CoT": "Hi there! Nice to meet you!",
        "Ours": "Hey! Nice to meet you too!"
      }
    }
  ]
}</pre>
                    <div class="field-table">
                        <table>
                            <tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr>
                            <tr><td>session_id</td><td>string</td><td>ä¼šè¯å”¯ä¸€æ ‡è¯†</td></tr>
                            <tr><td>user_profile</td><td>string</td><td>ç”¨æˆ·ç”»åƒ (èŒä¸š/çˆ±å¥½/èƒŒæ™¯)</td></tr>
                            <tr><td>user_personality</td><td>string</td><td>ç”¨æˆ·æ€§æ ¼ç‰¹å¾</td></tr>
                            <tr><td>rounds</td><td>array</td><td>å¯¹è¯è½®æ¬¡æ•°ç»„</td></tr>
                            <tr><td>rounds[].round</td><td>int</td><td>è½®æ¬¡ç¼–å· (ä»1å¼€å§‹)</td></tr>
                            <tr><td>rounds[].user_message</td><td>string</td><td>ç”¨æˆ·æ¶ˆæ¯</td></tr>
                            <tr><td>rounds[].responses</td><td>object</td><td>å„æ–¹æ³•çš„å“åº” (key=æ–¹æ³•å)</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="doc-card">
                    <h3>{{ t.doc_metrics_title }}</h3>
                    <p>{{ t.doc_metrics_desc }}</p>
                    <div class="metric-docs">
                        <div class="metric-doc">
                            <strong>AL(k) - ä¸»æŒ‡æ ‡</strong>
                            <p>ç¬¬kè½®çš„å¯¹é½æ°´å¹³ (Alignment Level at k-Turn)ï¼ŒèŒƒå›´ 0-100</p>
                            <code>AL(k) = Score at round k</code>
                        </div>
                        <div class="metric-doc">
                            <strong>AVG (Average Alignment Score)</strong>
                            <p>AL(k) åœ¨æ‰€æœ‰è½®æ¬¡ä¸Šçš„å¹³å‡å€¼</p>
                            <code>AVG = (1/K) Ã— Î£ AL(k)</code>
                        </div>
                        <div class="metric-doc">
                            <strong>Slope (b) - è¾…åŠ©æŒ‡æ ‡1</strong>
                            <p>çº¿æ€§å›å½’æ–œç‡ï¼Œåæ˜ å¯¹é½åˆ†æ•°éšè½®æ¬¡å¢åŠ çš„è¶‹åŠ¿</p>
                            <code>argmin<sub>b,a</sub> Î£(bÃ—k + a - AL(k))Â²</code>
                        </div>
                        <div class="metric-doc">
                            <strong>Intercept (a) - è¾…åŠ©æŒ‡æ ‡2</strong>
                            <p>çº¿æ€§å›å½’æˆªè·ï¼Œåæ˜ åˆå§‹å¯¹é½æ°´å¹³</p>
                            <code>argmin<sub>b,a</sub> Î£(bÃ—k + a - AL(k))Â²</code>
                        </div>
                        <div class="metric-doc">
                            <strong>RÂ² (Coefficient of Determination)</strong>
                            <p>å†³å®šç³»æ•°ï¼Œåæ˜ å¯¹é½æ”¹è¿›çš„ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§</p>
                            <code>RÂ² = 1 - SS<sub>res</sub>/SS<sub>tot</sub></code>
                        </div>
                        <div class="metric-doc">
                            <strong>N-AL(k) - å½’ä¸€åŒ–å¯¹é½æ°´å¹³</strong>
                            <p>å°† AL(k) å½’ä¸€åŒ–åˆ° 0-1 èŒƒå›´</p>
                            <code>N-AL(k) = (AL(k) - min AL) / (max AL - min AL)</code>
                        </div>
                        <div class="metric-doc">
                            <strong>Binary Alignment Rate</strong>
                            <p>ç”¨æˆ·"æƒ³ç»§ç»­èŠ"çš„æ¯”ä¾‹ (0-100%)</p>
                            <code>BAR = Î£(binary=1) / N Ã— 100%</code>
                        </div>
                    </div>
                </div>
                
                <div class="doc-card eval-criteria-card">
                    <h3>ğŸ¯ Binary Evaluation Criteria</h3>
                    <p>ä»»ä¸€ä¸æ»¡è¶³å³ä¸º 0 åˆ†</p>
                    <div class="criteria-list">
                        <div class="criteria-item">
                            <span class="criteria-num">â‘ </span>
                            <strong>Naturalness</strong>
                            <span>å›å¤æ˜¯å¦æµç•…ã€ç®€çŸ­ã€è‡ªç„¶ã€å£è¯­åŒ–ï¼Ÿ</span>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-num">â‘¡</span>
                            <strong>Relevance</strong>
                            <span>å›å¤æ˜¯å¦ä¸ç”¨æˆ·å…´è¶£ã€éœ€æ±‚ç›¸å…³ï¼Ÿ</span>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-num">â‘¢</span>
                            <strong>Logic</strong>
                            <span>å›å¤æ˜¯å¦æ­£ç¡®ç†è§£å¹¶å›åº”äº†æ¶ˆæ¯ï¼Ÿ</span>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-num">â‘£</span>
                            <strong>Excitement</strong>
                            <span>æ˜¯å¦è®©ç”¨æˆ·æœ‰ç»§ç»­æ¢çŸ¥çš„æ¬²æœ›ï¼Ÿ</span>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-num">â‘¤</span>
                            <strong>Value</strong>
                            <span>æ˜¯å¦é¿å…äº†ç®€å•é‡å¤æˆ–æ•·è¡å¹æ§ï¼Ÿ</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>{{ t.powered_by }}: PersonaSteer Team | 
           <a href="mailto:contact@personasteer.ai">{{ t.contact }}</a>
        </p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
